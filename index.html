<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Quest for Sham ğŸŒŸ</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body {
      background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
      min-height:100vh; display:flex; justify-content:center; align-items:center; overflow:hidden; position:relative; color:white;
    }
    .star { position:absolute; background:white; border-radius:50%; opacity:0.7; z-index:1; pointer-events:none; animation:twinkle var(--duration,4s) infinite ease-in-out; }
    @keyframes twinkle { 0%,100%{opacity:.3; transform:scale(.8);} 50%{opacity:1; transform:scale(1.2);} }

    .game-container {
      text-align:center; background:rgba(255,255,255,0.96); padding:50px 40px; border-radius:36px; box-shadow:0 25px 60px rgba(0,0,0,.5);
      max-width:650px; z-index:10; position:relative; transform:scale(1); transition:transform .3s;
    }
    .game-container:hover { transform:scale(1.02); }
    h1 { color:#2c3e50; font-size:40px; margin-bottom:22px; text-shadow:0 1px 3px rgba(0,0,0,.1); }
    p { font-size:20px; color:#34495e; margin:18px 0; line-height:1.7; font-weight:500; }

    .bubbles { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin:40px auto; max-width:480px; }
    .bubble {
      width:95px; height:95px; border-radius:50%; background:linear-gradient(135deg,#a1c4fd,#c2e9fb);
      display:flex; justify-content:center; align-items:center; font-size:36px; cursor:pointer;
      transition:all .35s cubic-bezier(.175,.885,.32,1.275); box-shadow:0 6px 16px rgba(0,0,0,.2); user-select:none; position:relative; overflow:hidden;
    }
    .bubble::before { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:radial-gradient(circle, rgba(255,255,255,.6) 0%, transparent 70%); opacity:0; transition:opacity .3s; }
    .bubble:hover { transform:scale(1.18) rotate(5deg); box-shadow:0 10px 25px rgba(44,62,80,.4); }
    .bubble:hover::before { opacity:1; }
    .bubble.clicked { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; transform:scale(.9) rotate(0deg); box-shadow:0 0 20px rgba(41,128,185,.7); animation:pulse 1.2s; }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(41,128,185,.7);} 70%{box-shadow:0 0 0 12px rgba(41,128,185,0);} 100%{box-shadow:0 0 0 0 rgba(41,128,185,0);} }
    .bubble.wrong { background:#ecf0f1; color:#bdc3c7; opacity:.5; transform:scale(.85); box-shadow:none; }

    .hint { font-style:italic; color:#2980b9; margin-top:25px; font-size:19px; font-weight:600; }
    .progress { display:flex; justify-content:center; gap:12px; margin-top:20px; }
    .progress-dot { width:16px; height:16px; border-radius:50%; background:#bdc3c7; transition:all .4s; }
    .progress-dot.active { background:#2980b9; transform:scale(1.3); }

    .level-indicator { display:flex; justify-content:center; gap:8px; margin:15px 0; }
    .level-dot { width:10px; height:10px; border-radius:50%; background:#bdc3c7; }
    .level-dot.active { background:#2980b9; }

    /* modals */
    .surprise, .try-again, .skip-confirm, .question-modal, .challenge-modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(10,10,25,.95); display:none; justify-content:center; align-items:center; z-index:200; flex-direction:column; backdrop-filter:blur(5px); }
    .surprise-content, .try-again-content, .skip-confirm-content, .question-content, .challenge-content { background:white; padding:70px 60px; border-radius:40px; text-align:center; max-width:700px; box-shadow:0 20px 70px rgba(0,0,0,.6); animation:popIn .8s cubic-bezier(.175,.885,.32,1.275); }
    @keyframes popIn { 0%{transform:scale(.5);opacity:0} 100%{transform:scale(1);opacity:1} }

    .close-btn, .try-again-btn, .skip-btn, .question-btn, .challenge-btn { margin-top:25px; padding:16px 50px; border-radius:50px; font-size:21px; font-weight:700; cursor:pointer; border:none; box-shadow:0 8px 25px rgba(26,42,108,.6); }
    .close-btn { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; }
    .try-again-btn { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; }
    .skip-btn.confirm { background:linear-gradient(135deg,#e74c3c,#c0392b); color:white; }
    .skip-btn.cancel { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; }
    .question-btn.submit { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; }
    .question-btn.cancel { background:linear-gradient(135deg,#e74c3c,#c0392b); color:white; }
    .question-btn.challenge { background:linear-gradient(135deg,#2ecc71,#27ae60); color:white; }
    .challenge-btn.complete { background:linear-gradient(135deg,#2ecc71,#27ae60); color:white; }
    .challenge-btn.back { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; }

    .confetti { position:absolute; width:12px; height:12px; z-index:199; pointer-events:none; }

    .level-complete { display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(255,255,255,.95); padding:40px 60px; border-radius:30px; text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.3); z-index:100; animation:popIn .8s cubic-bezier(.175,.885,.32,1.275); }
    .level-complete h3 { color:#2c3e50; font-size:36px; margin-bottom:20px; }
    .level-complete p { color:#34495e; font-size:22px; margin-bottom:30px; line-height:1.7; }

    .attempts { margin-top:15px; font-size:18px; color:#e74c3c; font-weight:600; }
    .timer { font-size:26px; font-weight:bold; color:#e74c3c; margin:15px 0; text-shadow:0 2px 4px rgba(0,0,0,.3); }
    .pairs-found { font-size:20px; color:#2980b9; font-weight:600; margin-top:10px; }
    .moves { font-size:18px; color:#e67e22; font-weight:600; margin-top:8px; }

    /* memory styles */
    .memory-grid { display:grid; gap:12px; margin:40px auto; max-width:420px; }
    .memory-card { width:85px; height:85px; perspective:1000px; margin:0 auto; }
    .memory-card-inner { position:relative; width:100%; height:100%; text-align:center; transition:transform .5s; transform-style:preserve-3d; }
    .memory-card.flipped .memory-card-inner { transform:rotateY(180deg); }
    .memory-card-front, .memory-card-back { position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; justify-content:center; align-items:center; border-radius:18px; font-size:28px; box-shadow:0 4px 12px rgba(0,0,0,.2); }
    .memory-card-front { background:linear-gradient(135deg,#a1c4fd,#c2e9fb); transform:rotateY(0deg); }
    .memory-card-back { background:linear-gradient(135deg,#2980b9,#1a2a6c); color:white; transform:rotateY(180deg); }
    .memory-card.matched .memory-card-front, .memory-card.matched .memory-card-back { opacity:.6; transform:scale(.95); }

    /* skip button */
    .skip-button { position:absolute; top:20px; right:20px; background:linear-gradient(135deg,#e74c3c,#c0392b); color:white; border:none; border-radius:50px; padding:12px 20px; font-size:18px; font-weight:700; cursor:pointer; transition:all .3s; box-shadow:0 6px 20px rgba(231,76,60,.6); z-index:11; }
    .skip-button:hover { transform:translateY(-3px) scale(1.05); box-shadow:0 10px 25px rgba(231,76,60,.8); }

    .question-input { width:80%; padding:15px 20px; font-size:20px; border:2px solid #bdc3c7; border-radius:15px; margin-bottom:30px; text-align:center; }
    .answer-confirmation { margin-top:20px; font-size:18px; color:#2980b9; font-weight:600; min-height:24px; }

    /* small responsive tweak */
    @media (max-width:520px) {
      .game-container { padding:30px 16px; max-width:92vw; }
      .bubble { width:72px; height:72px; font-size:28px;}
      .memory-card { width:68px; height:68px;}
    }
  </style>
</head>
<body>

<script>
  // background stars
  for (let i = 0; i < 80; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + 'vw';
    star.style.top = Math.random() * 100 + 'vh';
    star.style.width = (Math.random() * 4 + 1) + 'px';
    star.style.height = star.style.width;
    star.style.setProperty('--duration', (Math.random() * 5 + 3) + 's');
    star.style.animationDelay = Math.random() * 5 + 's';
    document.body.appendChild(star);
  }
</script>

<div class="game-container" id="gameContainer">
  <h1 id="levelTitle">ğŸ“š Find the 3 Study Symbols!</h1>
  <p id="levelDescription">Help <strong>Sham</strong> unlock his potential!<br>Click carefully to find the <u>3 knowledge symbols</u> among the distractions.</p>

  <div class="level-indicator" id="levelIndicator">
    <div class="level-dot active"></div>
    <div class="level-dot"></div>
    <div class="level-dot"></div>
    <div class="level-dot"></div>
    <div class="level-dot"></div>
    <div class="level-dot"></div>
  </div>

  <div class="bubbles" id="bubbles"><!-- filled by JS --></div>

  <p class="hint" id="hint">Begin your quest, Sham! Click any symbol...</p>

  <div class="attempts" id="attempts">Attempts: 0/5</div>
  <div class="timer" id="timer" style="display:none;">Time: 60s</div>
  <div class="pairs-found" id="pairsFound" style="display:none;">Pairs Found: 0/3</div>
  <div class="moves" id="moves" style="display:none;">Moves: 0</div>

  <div class="progress" id="progress">
    <div class="progress-dot active"></div>
    <div class="progress-dot"></div>
    <div class="progress-dot"></div>
  </div>

  <button class="skip-button" id="skipButton">Skip Level</button>
</div>

<div class="surprise" id="surprise">
  <div class="surprise-content">
    <h2>ğŸ“ You Did It, Sham! ğŸ“</h2>
    <p>I am <strong>SO PROUD</strong> of you.<br><br>Every page you read, every problem you solve, and every late night you spend studying is building your future.<br><br>Keep going â€” your journey is just beginning! âœ¨</p>
    <button class="close-btn" id="closeBtn">Back to Quest</button>
  </div>
</div>

<div class="level-complete" id="levelComplete">
  <h3>ğŸ‰ Level Complete!</h3>
  <p>Great job, Sham! You've mastered this level. Get ready for the next challenge!</p>
  <button class="close-btn" id="nextLevelBtn">Next Level</button>
</div>

<div class="try-again" id="tryAgain">
  <div class="try-again-content">
    <h2>ğŸ˜” You Ran Out of Attempts!</h2>
    <p>Don't be discouraged, Sham! Every mistake is a step toward mastery. Take a deep breath, review what you've learned, and try again!</p>
    <button class="try-again-btn" id="tryAgainBtn">Try Again</button>
  </div>
</div>

<div class="skip-confirm" id="skipConfirm">
  <div class="skip-confirm-content">
    <h2>âš ï¸ Are You Sure?</h2>
    <p>Skipping a level means you won't get the full learning experience.<br><br>To skip this level, you must answer a personal question correctly.</p>
    <div class="skip-btn-group">
      <button class="skip-btn cancel" id="cancelSkip">No, I'll Keep Trying</button>
      <button class="skip-btn confirm" id="confirmSkip">Answer Question to Skip</button>
    </div>
  </div>
</div>

<div class="question-modal" id="questionModal">
  <div class="question-content">
    <h2>ğŸ’Œ Personal Question</h2>
    <p id="questionText">What is the first time we met?</p>
    <input type="text" class="question-input" id="questionInput" placeholder="Type your answer...">
    <div class="answer-confirmation" id="answerConfirmation"></div>
    <div class="question-btn-group">
      <button class="question-btn cancel" id="cancelQuestion">Back</button>
      <button class="question-btn challenge" id="challengeQuestion">Take Challenge Instead</button>
      <button class="question-btn submit" id="submitQuestion">Submit Answer</button>
    </div>
  </div>
</div>

<div class="challenge-modal" id="challengeModal">
  <div class="challenge-content">
    <h2>ğŸ† Special Challenge from LET</h2>
    <p>Complete this challenge for Sham, and I'll give you the answer!<br><br><strong>Challenge:</strong> Send me a message saying "I completed the challenge for Sham!"<br><br>Once you've done this, click the button below and I'll reveal the secret answer.</p>
    <div class="challenge-btn-group">
      <button class="challenge-btn back" id="backFromChallenge">Back to Question</button>
      <button class="challenge-btn complete" id="completeChallenge">I Completed the Challenge!</button>
    </div>
  </div>
</div>

<script>
  // Levels and personal questions (unchanged content but included here)
  const levels = [
    {
      title: "ğŸ“š Find the 3 Study Symbols!",
      description: "Help <strong>Sham</strong> unlock his potential!<br>Click carefully to find the <u>3 knowledge symbols</u> among the distractions.",
      symbols: ['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ','ğŸš€','ğŸ†','ğŸ“Š','ğŸ”¬'],
      correctCount:3, maxAttempts:5, correctSymbols:['ğŸ“š','ğŸ§ ','ğŸ“'], canSkip:true
    },
    {
      title: "ğŸ§  Level 2: Spot the 4 Learning Icons!",
      description: "Sham is growing smarter! Find the <u>4 study symbols</u> among more distractions.",
      symbols: ['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ','ğŸš€','ğŸ†','ğŸ“Š','ğŸ”¬','ğŸ“–','ğŸ§®','ğŸŒ','ğŸ“ˆ'],
      correctCount:4, maxAttempts:6, correctSymbols:['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡'], canSkip:true
    },
    {
      title: "ğŸš€ Level 3: Master the 5 Study Emblems!",
      description: "You're becoming a study master! Find the <u>5 essential symbols</u> before time runs out!",
      symbols: ['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ','ğŸš€','ğŸ†','ğŸ“Š','ğŸ”¬','ğŸ“–','ğŸ§®','ğŸŒ','ğŸ“ˆ'],
      correctCount:5, maxAttempts:7, correctSymbols:['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸'], canSkip:true
    },
    {
      title: "ğŸ§ ğŸ§  Level 4: Memory Challenge!",
      description: "Test your memory, Sham! Match the <u>4 pairs</u> of study symbols within 45 seconds!",
      type:"memory", pairs:4, symbols:['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ'], maxTime:45, maxMoves:20, canSkip:true
    },
    {
      title: "âš¡ Level 5: Speed Memory!",
      description: "Quick reflexes needed! Match <u>5 pairs</u> in just 35 seconds!",
      type:"memory", pairs:5, symbols:['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ','ğŸš€','ğŸ†'], maxTime:35, maxMoves:25, canSkip:true
    },
    {
      title: "ğŸ† ULTIMATE CHALLENGE!",
      description: "The final test! Match <u>6 pairs</u> of advanced study symbols in 30 seconds with only 22 moves!",
      type:"memory", pairs:6, symbols:['ğŸ“š','ğŸ§ ','ğŸ“','ğŸ’¡','âœï¸','ğŸ”','ğŸ¯','ğŸŒŸ','ğŸš€','ğŸ†','ğŸ“Š','ğŸ”¬'], maxTime:30, maxMoves:22, canSkip:true
    }
  ];

  const personalQuestions = [
    { question:"What is the first time we met?", answers:["4/9","4/9/2025","4/9/25","april 9","april 9th","april 9, 2025","04/09","04/09/2025"] },
    { question:"What was my age when I used the PC?", answers:["4","four","4 years old","four years old"] },
    { question:"Did I support you enough?", answers:["yes","absolutely","definitely","of course","totally"] },
    { question:"What is something you noticed about me but never mentioned?", answers:["let","sham","let/sham","sham/let"] },
    { question:"Is there something I do that bothers you?", answers:["let","sham"] },
    { question:"What is one thing about me that always makes you smile?", answers:["let","sham"] },
    { question:"What about me surprised you as you got to know me better?", answers:["let","sham"] },
    { question:"What is something I used to do for you but now no longer do, and you want me to do it again?", answers:["let","sham"] },
    { question:"What is something we used to do that you miss and wish we did it more?", answers:["let","sham"] }
  ];

  // State
  let currentLevel = 0;
  let clicks = 0, correctClicks = 0, attempts = 0, timer = null, timeLeft = 0;
  let flippedCards = [], matchedPairs = 0, moves = 0;
  let usedQuestionIndices = [];

  // DOM refs
  const gameContainer = document.getElementById('gameContainer');
  const bubblesContainer = document.getElementById('bubbles');
  const hint = document.getElementById('hint');
  const surprise = document.getElementById('surprise');
  const closeBtn = document.getElementById('closeBtn');
  const progressDots = document.querySelectorAll('#progress .progress-dot');
  const levelTitle = document.getElementById('levelTitle');
  const levelDescription = document.getElementById('levelDescription');
  const attemptsDisplay = document.getElementById('attempts');
  const timerDisplay = document.getElementById('timer');
  const pairsFoundDisplay = document.getElementById('pairsFound');
  const movesDisplay = document.getElementById('moves');
  const levelComplete = document.getElementById('levelComplete');
  const nextLevelBtn = document.getElementById('nextLevelBtn');
  const tryAgain = document.getElementById('tryAgain');
  const tryAgainBtn = document.getElementById('tryAgainBtn');
  const skipButton = document.getElementById('skipButton');
  const skipConfirm = document.getElementById('skipConfirm');
  const cancelSkipBtn = document.getElementById('cancelSkip');
  const confirmSkipBtn = document.getElementById('confirmSkip');
  const questionModal = document.getElementById('questionModal');
  const questionText = document.getElementById('questionText');
  const questionInput = document.getElementById('questionInput');
  const submitQuestionBtn = document.getElementById('submitQuestion');
  const cancelQuestionBtn = document.getElementById('cancelQuestion');
  const challengeQuestionBtn = document.getElementById('challengeQuestion');
  const answerConfirmation = document.getElementById('answerConfirmation');
  const challengeModal = document.getElementById('challengeModal');
  const backFromChallengeBtn = document.getElementById('backFromChallenge');
  const completeChallengeBtn = document.getElementById('completeChallenge');

  // Initialize level
  function initLevel(levelIndex) {
    // reset
    clicks = 0; correctClicks = 0; attempts = 0; flippedCards = []; matchedPairs = 0; moves = 0;
    if (timer) { clearInterval(timer); timer = null; }

    const level = levels[levelIndex];
    levelTitle.innerHTML = level.title;
    levelDescription.innerHTML = level.description;

    // level indicator
    document.querySelectorAll('.level-dot').forEach((dot,i)=>dot.classList.toggle('active', i===levelIndex));

    skipButton.style.display = level.canSkip ? 'block' : 'none';

    // reset progress dots only for non-memory
    if (level.type !== 'memory') {
      progressDots.forEach(dot => dot.classList.remove('active'));
    }

    // clear container & reset class
    bubblesContainer.innerHTML = '';
    bubblesContainer.className = 'bubbles';

    // show/hide displays
    if (level.type === 'memory') {
      attemptsDisplay.style.display = 'none';
      timerDisplay.style.display = 'block';
      pairsFoundDisplay.style.display = 'block';
      movesDisplay.style.display = 'block';
      progressDots.forEach(dot => dot.style.display = 'none');
      createMemoryGame(level);
    } else {
      attemptsDisplay.style.display = 'block';
      timerDisplay.style.display = 'none';
      pairsFoundDisplay.style.display = 'none';
      movesDisplay.style.display = 'none';
      progressDots.forEach(dot => dot.style.display = 'inline-block');
      attemptsDisplay.textContent = `Attempts: ${attempts}/${level.maxAttempts}`;
      createFindGame(level);
    }

    hint.textContent = level.type === 'memory' ? "Click cards to flip them and find matching pairs!" : "Begin your quest, Sham! Click any symbol...";
    gameContainer.style.display = 'block';
    surprise.style.display = 'none';
    levelComplete.style.display = 'none';
    tryAgain.style.display = 'none';
    skipConfirm.style.display = 'none';
    questionModal.style.display = 'none';
    challengeModal.style.display = 'none';
  }

  // Find game (levels 1-3)
  function createFindGame(level) {
    const allSymbols = shuffle([...level.symbols]);
    allSymbols.forEach(symbol => {
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = symbol;
      bubble.dataset.isCorrect = level.correctSymbols.includes(symbol) ? 'true' : 'false';
      bubble.dataset.attempted = 'false';
      bubblesContainer.appendChild(bubble);
    });
    const bubbles = document.querySelectorAll('.bubble');
    bubbles.forEach(b => { b.removeEventListener('click', handleBubbleClick); b.addEventListener('click', handleBubbleClick); });
  }

  // Memory game (levels 4-6)
  function createMemoryGame(level) {
    // prepare pairs (take first N symbols)
    let pairsArray = [];
    for (let i=0;i<level.pairs;i++){ pairsArray.push(level.symbols[i]); pairsArray.push(level.symbols[i]); }
    pairsArray = shuffle(pairsArray);

    // grid columns
    const gridSize = level.pairs <= 4 ? 4 : level.pairs <= 8 ? 4 : 5;
    bubblesContainer.className = 'memory-grid';
    bubblesContainer.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

    pairsArray.forEach(symbol => {
      const card = document.createElement('div');
      card.className = 'memory-card';
      card.dataset.symbol = symbol;
      card.innerHTML = `<div class="memory-card-inner"><div class="memory-card-front">?</div><div class="memory-card-back">${symbol}</div></div>`;
      bubblesContainer.appendChild(card);
    });

    // timer
    timeLeft = level.maxTime;
    timerDisplay.textContent = `Time: ${timeLeft}s`;
    timer = setInterval(() => {
      timeLeft--;
      timerDisplay.textContent = `Time: ${timeLeft}s`;
      if (timeLeft <= 0) {
        clearInterval(timer); timer = null;
        showTryAgain();
        hint.textContent = "â° Time's up! Better luck next time!";
      }
    }, 1000);

    pairsFoundDisplay.textContent = `Pairs Found: ${matchedPairs}/${level.pairs}`;
    movesDisplay.textContent = `Moves: ${moves}/${level.maxMoves}`;

    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => { card.removeEventListener('click', handleMemoryCardClick); card.addEventListener('click', handleMemoryCardClick); });
  }

  function handleMemoryCardClick(e) {
    const card = e.target.closest('.memory-card');
    if (!card) return;
    const level = levels[currentLevel];

    if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
    if (moves >= level.maxMoves && matchedPairs < level.pairs) { showTryAgain(); hint.textContent = "âŒ You've used all your moves! Try again!"; return; }

    // flip
    card.classList.add('flipped');
    flippedCards.push(card);

    if (flippedCards.length === 2) {
      moves++;
      movesDisplay.textContent = `Moves: ${moves}/${level.maxMoves}`;
      const [card1, card2] = flippedCards;
      const symbol1 = card1.dataset.symbol, symbol2 = card2.dataset.symbol;
      if (symbol1 === symbol2) {
        card1.classList.add('matched'); card2.classList.add('matched');
        matchedPairs++;
        pairsFoundDisplay.textContent = `Pairs Found: ${matchedPairs}/${level.pairs}`;
        flippedCards = [];
        if (matchedPairs === level.pairs) {
          clearInterval(timer); timer = null;
          hint.textContent = "ğŸ‰ Memory Master! Preparing your next challenge...";
          setTimeout(()=> showLevelComplete(), 800);
        }
      } else {
        setTimeout(()=> {
          card1.classList.remove('flipped'); card2.classList.remove('flipped'); flippedCards = [];
        }, 800);
      }

      if (moves >= level.maxMoves && matchedPairs < level.pairs) {
        showTryAgain(); hint.textContent = "âŒ You've used all your moves! Try again!";
      }
    }
  }

  // Fisherâ€“Yates shuffle
  function shuffle(array) {
    for (let i=array.length-1;i>0;i--) {
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Find game click
  function handleBubbleClick(e) {
    const bubble = e.currentTarget;
    if (!bubble) return;
    if (bubble.classList.contains('clicked') || bubble.classList.contains('wrong')) return;

    const isCorrect = bubble.dataset.isCorrect === 'true';
    clicks++;

    if (isCorrect) {
      correctClicks++;
      bubble.classList.add('clicked');
    } else {
      attempts++;
      bubble.classList.add('wrong');
      const level = levels[currentLevel];
      attemptsDisplay.textContent = `Attempts: ${attempts}/${level.maxAttempts}`;
      if (attempts >= level.maxAttempts && correctClicks < level.correctCount) {
        hint.textContent = "ğŸ˜” You've used all your attempts. Try again!";
        const bubbles = document.querySelectorAll('.bubble');
        bubbles.forEach(b => { if (b.dataset.isCorrect === 'true' && !b.classList.contains('clicked')) { b.classList.add('clicked'); b.style.opacity='.7'; }});
        showTryAgain();
        return;
      }
    }

    // progress dots (only first 3 exist visually)
    progressDots.forEach((dot,i)=> dot.classList.toggle('active', i < correctClicks));

    // hints
    const level = levels[currentLevel];
    if (correctClicks === 1) hint.textContent = `Amazing, Sham! One down, ${level.correctCount-1} to go!`;
    else if (correctClicks === 2) hint.textContent = `You're crushing it! ${level.correctCount-2} more to go!`;
    else if (correctClicks === 3 && level.correctCount > 3) hint.textContent = `Incredible! You've found 3 symbols. Keep going!`;
    else if (correctClicks === level.correctCount-1) hint.textContent = "Just one more! You're almost there!";
    else if (correctClicks === level.correctCount) { hint.textContent = "ğŸ‰ Victory is yours! Preparing your next challenge..."; setTimeout(()=> showLevelComplete(), 800); }
    else if (clicks >= 6 && correctClicks < level.correctCount && attempts > 0) hint.textContent = "Don't give up! You're smarter than this!";
  }

  function showLevelComplete() {
    gameContainer.style.display = 'none';
    levelComplete.style.display = 'block';
    createConfetti();
  }

  function showTryAgain() {
    gameContainer.style.display = 'none';
    tryAgain.style.display = 'flex';
  }

  function showSurprise() {
    createConfetti();
    gameContainer.style.display = 'none';
    surprise.style.display = 'flex';
  }

  function createConfetti() {
    const colors = ['#2980b9','#1a2a6c','#f1c40f','#2ecc71','#e74c3c','#9b59b6','#3498db'];
    for (let i=0;i<120;i++){
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random()*100 + 'vw';
      confetti.style.top = '-10px';
      confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      confetti.style.width = (Math.random()*12+8)+'px';
      confetti.style.height = confetti.style.width;
      confetti.style.borderRadius = Math.random()>.5 ? '50%' : '0';
      document.body.appendChild(confetti);
      const anim = confetti.animate([{top:'-10px', opacity:1, transform:'rotate(0deg)'},{top:'100vh', opacity:0, transform:`rotate(${Math.random()*360}deg)`}], {duration:Math.random()*3500+2500, easing:'cubic-bezier(.1,.8,.2,1)'});
      anim.onfinish = ()=> confetti.remove();
    }
  }

  // Questions logic
  function getRandomQuestion() {
    if (usedQuestionIndices.length >= personalQuestions.length) usedQuestionIndices = [];
    let available = [];
    for (let i=0;i<personalQuestions.length;i++) if (!usedQuestionIndices.includes(i)) available.push(i);
    if (available.length === 0) { available = Array.from({length:personalQuestions.length},(_,i)=>i); usedQuestionIndices=[]; }
    const idx = available[Math.floor(Math.random()*available.length)];
    usedQuestionIndices.push(idx);
    return personalQuestions[idx];
  }

  // Event listeners: UI buttons
  closeBtn.addEventListener('click', ()=> {
    surprise.style.display = 'none';
    gameContainer.style.display = 'block';
    currentLevel = 0;
    initLevel(currentLevel);
  });

  nextLevelBtn.addEventListener('click', ()=> {
    levelComplete.style.display = 'none';
    currentLevel++;
    if (currentLevel < levels.length) initLevel(currentLevel);
    else showSurprise();
  });

  tryAgainBtn.addEventListener('click', ()=> { tryAgain.style.display='none'; initLevel(currentLevel); });

  skipButton.addEventListener('click', ()=> { skipConfirm.style.display = 'flex'; });
  cancelSkipBtn.addEventListener('click', ()=> { skipConfirm.style.display = 'none'; });
  confirmSkipBtn.addEventListener('click', ()=> {
    skipConfirm.style.display = 'none';
    const question = getRandomQuestion();
    questionText.textContent = question.question;
    questionInput.value = ''; answerConfirmation.textContent = '';
    questionModal.style.display = 'flex';
    questionInput.focus();
  });

  cancelQuestionBtn.addEventListener('click', ()=> { questionModal.style.display='none'; skipConfirm.style.display='flex'; });
  challengeQuestionBtn.addEventListener('click', ()=> { questionModal.style.display='none'; challengeModal.style.display='flex'; });
  backFromChallengeBtn.addEventListener('click', ()=> { challengeModal.style.display='none'; questionModal.style.display='flex'; });

  completeChallengeBtn.addEventListener('click', ()=> {
    // reveal answer automatically as "Sham/LET"
    questionInput.value = "Sham/LET";
    answerConfirmation.textContent = "âœ… Challenge completed! Answer revealed: Sham/LET";
    answerConfirmation.style.color = "#27ae60";
    setTimeout(()=> { challengeModal.style.display='none'; questionModal.style.display='flex'; setTimeout(()=> submitQuestionBtn.click(), 800); }, 1000);
  });

  submitQuestionBtn.addEventListener('click', ()=> {
    const answer = questionInput.value.trim().toLowerCase();
    const question = personalQuestions.find(q => q.question === questionText.textContent);
    if (!question) return;
    const isChallengeAnswer = ["sham/let","let/sham","sham","let","sham let","let sham"].includes(answer);
    const isCorrect = isChallengeAnswer || question.answers.some(correct => answer === correct.toLowerCase() || answer.includes(correct.toLowerCase()) || correct.toLowerCase().includes(answer));
    if (isCorrect) {
      answerConfirmation.textContent = "âœ… Correct! You've earned the right to skip."; answerConfirmation.style.color = "#27ae60";
      setTimeout(()=> {
        questionModal.style.display='none';
        currentLevel++;
        if (currentLevel < levels.length) initLevel(currentLevel);
        else showSurprise();
      }, 900);
    } else {
      answerConfirmation.textContent = "âŒ That's not quite right. Try again!"; answerConfirmation.style.color = "#e74c3c";
      questionInput.value=''; questionInput.focus();
    }
  });

  questionInput.addEventListener('keypress', (e)=> { if (e.key === 'Enter') submitQuestionBtn.click(); });

  // start the game
  initLevel(currentLevel);
</script>

</body>
</html>